---
import type { CollectionEntry } from "astro:content";
import {
    SITE,
    USE_POST_IMG_OVERLAY,
    USE_AUTHOR_CARD,
    USE_SUBSCRIPTION,
    USE_VIEW_STATS,
} from "$/config";
import MainLayout from "$/components/MainLayout.astro";
import BaseHead from "$/components/BaseHead.astro";
import Prose from "$/components/Prose.astro";
import PostStats from "$/components/PostStats.svelte";
import EditUrl from "$/components/EditLink.astro";

interface Props {
    meta?: {
        id: string;
        slug: string;
        collection: string;
    };
    content: CollectionEntry<"blog">["data"];
    stats?: {
        views: number;
    };
}
const { content, meta } = Astro.props;

const AUTHOR_NAME = content.author
    ? content.author
    : SITE?.author
      ? SITE?.author
      : "Author";
const AUTHOR_TWITTER = content.authorTwitter
    ? content.authorTwitter
    : SITE?.authorTwitter
      ? SITE?.authorTwitter
      : "";
const AUTHOR_AVATAR = content.authorImage
    ? content.authorImage
    : SITE?.authorImage
      ? SITE?.authorImage
      : "";
---

<!doctype html>
<html lang="en">
    <head>
        <BaseHead
            {...content}
            title={content.title
                ? `${SITE.title} | ${content.title}`
                : SITE.title}
        />
    </head>
    <MainLayout>
        <div class="post__header">
            <div class="post__tags">
                {
                    content.tags.length > 0 &&
                        content.tags.map((tag) => (
                            <a
                                class="post__tag"
                                href={`/tags/${tag}`}
                                title={tag}
                            >
                                {tag}
                            </a>
                        ))
                }
            </div>
            <h1 class="post__title">{content.title}</h1>
            <h5
                class={`post__desc ${AUTHOR_AVATAR ? "flex flex-row gap-2" : ""}`}
            >
                {
                    AUTHOR_AVATAR ? (
                        <img
                            class="avatar"
                            src={AUTHOR_AVATAR}
                            alt={`${AUTHOR_NAME}'s avatar`}
                        />
                    ) : (
                        ""
                    )
                }
                <div
                    class={AUTHOR_AVATAR ? "flex flex-col border-l-2 pl-2" : ""}
                >
                    {
                        AUTHOR_TWITTER ? (
                            <a
                                class="post__author"
                                href={`https://twitter.com/${AUTHOR_TWITTER}`}
                                title={`${AUTHOR_NAME}'s twitter`}
                                target="_blank"
                                rel="external"
                            >
                                {AUTHOR_NAME}
                            </a>
                        ) : (
                            <span class="post__author">{AUTHOR_NAME}</span>
                        )
                    }
                    {!AUTHOR_AVATAR ? " | " : ""}
                    <span class="post__date">
                        <!-- post creation/updation data -->
                        {
                            new Intl.DateTimeFormat("en-US", {
                                dateStyle: "full",
                            }).format(new Date(content.date))
                        }
                    </span>
                    <span class="post__stats">
                        {USE_VIEW_STATS && ` | `}
                        {
                            USE_VIEW_STATS && (
                                <>
                                    <svg class="w-5 h-5 inline-block" viewBox="0 0 24 24" fill="currentColor"><path d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z" /></svg>
                                    <PostStats slug={meta?.slug} client:load />
                                </>
                            )
                        }
                        <!-- | <Icon class="w-5 h-5 inline-block" pack="mdi" name="clock" /> 2 mins -->
                    </span>
                </div>
            </h5>
        </div>
        {
            content.image ? (
                USE_POST_IMG_OVERLAY ? (
                    <>
                        <div class="img__outer">
                            <img src={content.image} alt={content.title} />
                            <div class="img_gradient" />
                        </div>
                        <br />
                    </>
                ) : (
                    <>
                        <img
                            class="img__outer"
                            src={content.image}
                            alt={content.title}
                        />
                        <br />
                    </>
                )
            ) : (
                ""
            )
        }
        <Prose>
            <slot />
        </Prose>
        <div class="post__footer">
            {
                USE_AUTHOR_CARD && (
                    <>
                        <br />
                        <div class="author-card">
                            {AUTHOR_AVATAR ? (
                                <img
                                    class="author-card__img avatar avatar--lg"
                                    src={AUTHOR_AVATAR}
                                    alt={`${AUTHOR_NAME}'s avatar`}
                                />
                            ) : (
                                ""
                            )}
                            <div class="author-card__meta">
                                {AUTHOR_TWITTER ? (
                                    <a
                                        class="author-card__author"
                                        href={`https://twitter.com/${AUTHOR_TWITTER}`}
                                        title={`${AUTHOR_NAME}'s twitter`}
                                        target="_blank"
                                        rel="external"
                                    >
                                        {AUTHOR_NAME}
                                    </a>
                                ) : (
                                    <span class="author-card__author">
                                        {AUTHOR_NAME}
                                    </span>
                                )}
                                <p class="author-card__bio">{SITE.authorBio}</p>
                                <br />
                                {USE_SUBSCRIPTION ? (
                                    <form action="" class="subscription-form">
                                        <label for="email" />
                                        <input
                                            type="email"
                                            name="email"
                                            class="flex-grow border-0 text-theme-accent-gray-dark"
                                            required="true"
                                        />
                                        <button type="submit">Subscribe</button>
                                    </form>
                                ) : (
                                    <a
                                        class=""
                                        target="_blank"
                                        href={`https://twitter.com/intent/follow?screen_name=${AUTHOR_TWITTER}`}
                                    >
                                        <svg class="w-5 h-5 inline-block" viewBox="0 0 24 24" fill="currentColor"><path d="M22.46,6C21.69,6.35 20.86,6.58 20,6.69C20.88,6.16 21.56,5.32 21.88,4.31C21.05,4.81 20.13,5.16 19.16,5.36C18.37,4.5 17.26,4 16,4C13.65,4 11.73,5.92 11.73,8.29C11.73,8.63 11.77,8.96 11.84,9.27C8.28,9.09 5.11,7.38 3,4.79C2.63,5.42 2.42,6.16 2.42,6.94C2.42,8.43 3.17,9.75 4.33,10.5C3.62,10.5 2.96,10.3 2.38,10C2.38,10 2.38,10 2.38,10.03C2.38,12.11 3.86,13.85 5.82,14.24C5.46,14.34 5.08,14.39 4.69,14.39C4.42,14.39 4.15,14.36 3.89,14.31C4.43,16 6,17.26 7.89,17.29C6.43,18.45 4.58,19.13 2.56,19.13C2.22,19.13 1.88,19.11 1.54,19.07C3.44,20.29 5.7,21 8.12,21C16,21 20.33,14.46 20.33,8.79C20.33,8.6 20.33,8.42 20.32,8.23C21.16,7.63 21.88,6.87 22.46,6Z" /></svg>{" "}
                                        Follow on Twitter
                                    </a>
                                )}
                            </div>
                        </div>
                        <br />
                    </>
                )
            }
            {
                meta?.collection && meta?.id && (
                    <EditUrl
                        label=" Suggest changes on GitHub"
                        editUrl={`${SITE.githubUrl}/tree/main/src/content/${meta?.collection}/${meta?.id}`}
                    />
                )
            }
        </div>
    </MainLayout>
    <style>
        .post__header {
            @apply py-4 mb-1 text-center md:text-left;
        }
        .post__title {
            @apply text-5xl font-extrabold text-theme-dark-primary;
        }
        .post__desc {
            @apply text-white  flex justify-center text-left md:flex-none md:justify-start;
        }
        .post__author {
            @apply no-underline text-white hover:text-theme-primary;
        }
        .post__date,
        .post__stats {
            @apply text-white;
        }
        .post__tags {
            @apply inline-flex gap-2;
        }
        .post__tag {
            @apply text-white hover:text-theme-primary;
        }

        .avatar {
            @apply w-12 h-12 rounded-full object-cover p-1 border-2 border-solid border-theme-dark-primary ;
        }
        .avatar--lg {
            @apply w-32 h-32;
        }

        .img__outer {
            @apply relative rounded-lg shadow-xl overflow-hidden;
        }
        .img_gradient {
            @apply absolute z-10 w-full bottom-0 left-0 h-full bg-gradient-to-tr from-theme-primary;
        }

        .author-card {
            @apply text-white flex flex-row gap-4 justify-start text-left;
        }
        .author-card__meta {
            @apply border-l pl-4;
        }
        .author-card__author {
            @apply text-2xl mb-1;
        }
        .author-card__bio {
            @apply text-white;
        }

        .subscription-form {
            @apply w-4/6 mt-2 flex flex-row rounded-lg overflow-hidden shadow-lg;
        }
        .subscription-form input {
            @apply flex-grow border-0 text-theme-accent-gray-dark;
        }
        .subscription-form button,
        .button {
            @apply px-4 py-2 uppercase font-bold text-white bg-gradient-to-tr from-theme-primary to-theme-dark-secondary;
        }
        .author-card__follow-btn {
            @apply rounded-md shadow-md shadow-theme-dark-secondary hover:shadow-theme-secondary hover:shadow-lg transition-all;
        }
    </style>
</html>
